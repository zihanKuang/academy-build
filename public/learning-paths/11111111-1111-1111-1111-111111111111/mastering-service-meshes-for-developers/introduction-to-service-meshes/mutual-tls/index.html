<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=https://cloud.layer5.io/academy/favicons/favicon.ico><link rel=apple-touch-icon href=https://cloud.layer5.io/academy/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=https://cloud.layer5.io/academy/favicons/android-192x192.png sizes=192x192><title>Mutual TLS & Identity Verification | Layer5 Academy</title><meta name=description content="Meshery, collaborative Kubernetes manager"><meta property="og:url" content="https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/mutual-tls/"><meta property="og:site_name" content="Layer5 Academy"><meta property="og:title" content="Mutual TLS & Identity Verification"><meta property="og:description" content="Meshery, collaborative Kubernetes manager"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="learning-paths"><meta itemprop=name content="Mutual TLS & Identity Verification"><meta itemprop=description content="Meshery, collaborative Kubernetes manager"><meta itemprop=wordCount content="823"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mutual TLS & Identity Verification"><meta name=twitter:description content="Meshery, collaborative Kubernetes manager"><link rel=preload href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css as=style integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><link href=https://cloud.layer5.io/academy/scss/main.min.8d61368d36274adb6675933a7937cfa090b823abdb581eede811dfeab0c3628e.css rel=stylesheet integrity="sha256-jWE2jTYnSttmdZM6eTfPoJC4I6vbWB7t6BHf6rDDYo4=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="form-control td-search__input" placeholder="Search this siteâ€¦" aria-label="Search this siteâ€¦" autocomplete=off data-offline-search-index-json-src=https://cloud.layer5.io/academy/offline-search-index.f16c09dddb81ca89db2c4b5cb89e7f49.json data-offline-search-base-href=https://cloud.layer5.io/academy/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developers-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developers><span>Mastering Service Meshes for Developers</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshes><span>Introduction to Service Meshes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesgetting-started-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesgetting-started><span>Getting Started with Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesdeploy-an-application-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/deploy-an-application/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesdeploy-an-application><span>Deploy a Sample Application</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesexpose-services-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/expose-services/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesexpose-services><span>Exposing services through Istio Ingress Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesobservability-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/observability/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesobservability><span>Observability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesrouting-and-canary-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/routing-and-canary/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesrouting-and-canary><span>Request Routing and Canary Testing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesfault-injection-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/fault-injection/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesfault-injection><span>Fault Injection</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesmutual-tls-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/mutual-tls/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesmutual-tls><span class=td-sidebar-nav-active-item>Mutual TLS & Identity Verification</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshescircuit-breaking-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/circuit-breaking/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshescircuit-breaking><span>Circuit Breaking</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesconclusion-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/conclusion/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersintroduction-to-service-meshesconclusion><span>Conclusion</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshes><span>Advance Concepts of Service Meshes</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesgetting-started-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesgetting-started><span>Getting Started with Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesdeploy-an-application-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/deploy-an-application/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesdeploy-an-application><span>Deploy a sample application</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesexpose-services-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/expose-services/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesexpose-services><span>Expose services through Istio Ingress Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesservice-security-capabilities-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/service-security-capabilities/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesservice-security-capabilities><span>Service Security Capabilities of Istio</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-mesheswebassembly-and-intelligent-data-planes-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/webassembly-and-intelligent-data-planes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-mesheswebassembly-and-intelligent-data-planes><span>WebAssembly and Intelligent Data Planes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesconclusion-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/conclusion/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesconclusion><span>Conclusion</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesobservability-li><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/advance-concepts-of-service-meshes/observability/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-learning-paths11111111-1111-1111-1111-111111111111mastering-service-meshes-for-developersadvance-concepts-of-service-meshesobservability><span>Observability with Istio</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div></aside><main class="col-12 col-md-9 col-xl-8" role=main><div class="page-header d-flex justify-content-between align-items-center"><div class=breadcrumb-container><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/>Learning Paths</a></li><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/>Mastering Service Meshes for Developers</a></li><li class=breadcrumb-item><a href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/>Introduction to Service Meshes</a></li><li class="breadcrumb-item active" aria-current=page>Mutual TLS & Identity Verification</li></ol></nav></div></div><div class=td-content data-bs-theme=dark><h1>Mutual TLS & Identity Verification</h1><div class=lead>Meshery, collaborative Kubernetes manager</div><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 4 minute read &nbsp;</p></header><div class=chapter-content><p>Istio provides transparent mutual TLS to services inside the service mesh where both the client and the server authenticate each others&rsquo; certificates as part of the TLS handshake. As part of this course, we have deployed Istio with mTLS.</p><p>By default istio sets mTLS in <code>PERMISSIVE</code> mode which allows plain text traffic to be sent and accepted by a mesh. We first disallow plain text traffic using <code>PeerAuthentication</code> and setting mTLS mode to STRICT.</p><h3 id=confirm-mtls-is-being-enforced class=heading-link><strong>Confirm mTLS is being enforced</strong>
<a href=#confirm-mtls-is-being-enforced class=heading-anchor aria-label="Permalink to this heading">ðŸ”—</a></h3><p>This can be easily done by executing a simple command:-</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get peerauthentication --all-namespaces
</span></span></code></pre></div><h3 id=verify-mtls class=heading-link><strong>Verify mTLS</strong>
<a href=#verify-mtls class=heading-anchor aria-label="Permalink to this heading">ðŸ”—</a></h3><p>Citadel is Istioâ€™s key management service. As a first step, confirm that Citadel is up and running:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl get deploy -l <span class=nv>istio</span><span class=o>=</span>citadel -n istio-system
</span></span></code></pre></div><p>Output will be similar to:</p><pre tabindex=0><code>NAME            READY   UP-TO-DATE   AVAILABLE   AGE
istio-citadel   1/1     1            1           3m23s
</code></pre><p>To experiment with mTLS, let&rsquo;s do so by logging into the sidecar proxy of the <code>productpage</code> pod by executing this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl <span class=nb>exec</span> -it <span class=k>$(</span>kubectl get pod <span class=p>|</span> grep productpage <span class=p>|</span> awk <span class=s1>&#39;{ print $1 }&#39;</span><span class=k>)</span> -c istio-proxy -- /bin/bash
</span></span></code></pre></div><p>We are now in the proxy of the <code>productpage</code> pod. Check that all the ceritificates are loaded in this proxy:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>ls /etc/certs/
</span></span></code></pre></div><p>You should see 3 entries:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cert-chain.pem  key.pem  root-cert.pem
</span></span></code></pre></div><p>Now, try to make a curl call to the <code>details</code> service over HTTP:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl http://details:9080/details/0
</span></span></code></pre></div><p>Since, we have TLS between the sidecar&rsquo;s, an HTTP call will not work. The request will timeout. You will see an error like the one below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl: <span class=o>(</span>7<span class=o>)</span> Failed to connect to details port 9080: Connection timed out
</span></span></code></pre></div><p>Let us try to make a curl call to the details service over HTTPS but <strong>WITHOUT</strong> certs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl https://details:9080/details/0 -k
</span></span></code></pre></div><p>The request will be denied and you will see an error like the one below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl: <span class=o>(</span>16<span class=o>)</span> SSL_write<span class=o>()</span> returned SYSCALL, <span class=nv>errno</span> <span class=o>=</span> <span class=m>104</span>
</span></span></code></pre></div><p>Now, let us use curl over HTTPS with certificates to the details service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>curl https://details:9080/details/0 -v --key /etc/certs/key.pem --cert /etc/certs/cert-chain.pem --cacert /etc/certs/root-cert.pem -k
</span></span></code></pre></div><p>Output will be similar to this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>*   Trying 10.107.35.26...
</span></span><span class=line><span class=cl>* Connected to details <span class=o>(</span>10.107.35.26<span class=o>)</span> port <span class=m>9080</span> <span class=o>(</span><span class=c1>#0)</span>
</span></span><span class=line><span class=cl>* found <span class=m>1</span> certificates in /etc/certs/root-cert.pem
</span></span><span class=line><span class=cl>* found <span class=m>0</span> certificates in /etc/ssl/certs
</span></span><span class=line><span class=cl>* ALPN, offering http/1.1
</span></span><span class=line><span class=cl>* SSL connection using TLS1.2 / ECDHE_RSA_AES_128_GCM_SHA256
</span></span><span class=line><span class=cl>*        server certificate verification SKIPPED
</span></span><span class=line><span class=cl>*        server certificate status verification SKIPPED
</span></span><span class=line><span class=cl>* error fetching CN from cert:The requested data were not available.
</span></span><span class=line><span class=cl>*        common name:  <span class=o>(</span>does not match <span class=s1>&#39;details&#39;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>*        server certificate expiration date OK
</span></span><span class=line><span class=cl>*        server certificate activation date OK
</span></span><span class=line><span class=cl>*        certificate public key: RSA
</span></span><span class=line><span class=cl>*        certificate version: <span class=c1>#3</span>
</span></span><span class=line><span class=cl>*        subject: <span class=nv>O</span><span class=o>=</span><span class=c1>#1300</span>
</span></span><span class=line><span class=cl>*        start date: Thu, <span class=m>26</span> Oct <span class=m>2018</span> 14:36:56 GMT
</span></span><span class=line><span class=cl>*        expire date: Wed, <span class=m>05</span> Jan <span class=m>2019</span> 14:36:56 GMT
</span></span><span class=line><span class=cl>*        issuer: <span class=nv>O</span><span class=o>=</span>k8s.cluster.local
</span></span><span class=line><span class=cl>*        compression: NULL
</span></span><span class=line><span class=cl>* ALPN, server accepted to use http/1.1
</span></span><span class=line><span class=cl>&gt; GET /details/0 HTTP/1.1
</span></span><span class=line><span class=cl>&gt; Host: details:9080
</span></span><span class=line><span class=cl>&gt; User-Agent: curl/7.47.0
</span></span><span class=line><span class=cl>&gt; Accept: */*
</span></span><span class=line><span class=cl>&gt;
</span></span><span class=line><span class=cl>&lt; HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>&lt; content-type: application/json
</span></span><span class=line><span class=cl>&lt; server: envoy
</span></span><span class=line><span class=cl>&lt; date: Thu, <span class=m>07</span> Jun <span class=m>2018</span> 15:19:46 GMT
</span></span><span class=line><span class=cl>&lt; content-length: <span class=m>178</span>
</span></span><span class=line><span class=cl>&lt; x-envoy-upstream-service-time: <span class=m>1</span>
</span></span><span class=line><span class=cl>&lt; x-envoy-decorator-operation: default-route
</span></span><span class=line><span class=cl>&lt;
</span></span><span class=line><span class=cl>* Connection <span class=c1>#0 to host details left intact</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;id&#34;</span>:0,<span class=s2>&#34;author&#34;</span>:<span class=s2>&#34;William Shakespeare&#34;</span>,<span class=s2>&#34;year&#34;</span>:1595,<span class=s2>&#34;type&#34;</span>:<span class=s2>&#34;paperback&#34;</span>,<span class=s2>&#34;pages&#34;</span>:200,<span class=s2>&#34;publisher&#34;</span>:<span class=s2>&#34;PublisherA&#34;</span>,<span class=s2>&#34;language&#34;</span>:<span class=s2>&#34;English&#34;</span>,<span class=s2>&#34;ISBN-10&#34;</span>:<span class=s2>&#34;1234567890&#34;</span>,<span class=s2>&#34;ISBN-13&#34;</span>:<span class=s2>&#34;123-1234567890&#34;</span><span class=o>}</span>
</span></span></code></pre></div><p>This proves the existence of mTLS between the services on the Istio mesh.</p><p>Now lets come out of the container before we go to the next section:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>exit</span>
</span></span></code></pre></div><h3 id=secure-production-identity-framework-for-everyone-spiffe class=heading-link><strong>Secure Production Identity Framework for Everyone (SPIFFE)</strong>
<a href=#secure-production-identity-framework-for-everyone-spiffe class=heading-anchor aria-label="Permalink to this heading">ðŸ”—</a></h3><br>Istio uses [SPIFFE](https://spiffe.io/) to assert the identify of workloads on the
cluster. SPIFFE consists of a notion of identity and a method of proving it. A SPIFFE
identity consists of an authority part and a path. The meaning of the path in spiffe land
is implementation defined. In k8s it takes the form `/ns/$namespace/sa/$service-account`
with the expected meaning. A SPIFFE identify is embedded in a document. This document in
principle can take many forms but currently the only defined format is x509.<p>To start our investigation, let us check if the certs are in place in the productpage sidecar:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl <span class=nb>exec</span> <span class=k>$(</span>kubectl get pod -l <span class=nv>app</span><span class=o>=</span>productpage -o <span class=nv>jsonpath</span><span class=o>={</span>.items..metadata.name<span class=o>}</span><span class=k>)</span> -c istio-proxy -- ls /etc/certs
</span></span></code></pre></div><p>Output will be similar to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>cert-chain.pem
</span></span><span class=line><span class=cl>key.pem
</span></span><span class=line><span class=cl>root-cert.pem
</span></span></code></pre></div><p>Mac users, MacOS should have openssl available. If your machine does not have openssl install, install it using your preferred method.</p><p>Here is one way to install it on RHEL or CentOS or its derivatives:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo yum install -y openssl-devel
</span></span></code></pre></div><p>Here is one way to install it on Ubuntu or Debian or its derivatives:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo apt install -y libssl-dev
</span></span></code></pre></div><p>Now that we have found the certs, let us verify the certificate of productpage sidecar by running this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl <span class=nb>exec</span> <span class=k>$(</span>kubectl get pod -l <span class=nv>app</span><span class=o>=</span>productpage -o <span class=nv>jsonpath</span><span class=o>={</span>.items..metadata.name<span class=o>}</span><span class=k>)</span> -c istio-proxy -- cat /etc/certs/cert-chain.pem <span class=p>|</span> openssl x509 -text -noout  <span class=p>|</span> grep Validity -A <span class=m>2</span>
</span></span></code></pre></div><p>Output will be similar to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>    Not Before: Sep <span class=m>23</span> 17:32:28 <span class=m>2019</span> GMT
</span></span><span class=line><span class=cl>    Not After : Dec <span class=m>22</span> 17:32:28 <span class=m>2019</span> GMT
</span></span></code></pre></div><p>Lets also verify the URI SAN:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl <span class=nb>exec</span> <span class=k>$(</span>kubectl get pod -l <span class=nv>app</span><span class=o>=</span>productpage -o <span class=nv>jsonpath</span><span class=o>={</span>.items..metadata.name<span class=o>}</span><span class=k>)</span> -c istio-proxy -- cat /etc/certs/cert-chain.pem <span class=p>|</span> openssl x509 -text -noout  <span class=p>|</span> grep <span class=s1>&#39;Subject Alternative Name&#39;</span> -A <span class=m>1</span>
</span></span></code></pre></div><p>Output will be similar to:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>X509v3 Subject Alternative Name: critical
</span></span><span class=line><span class=cl>    URI:spiffe://cluster.local/ns/default/sa/bookinfo-productpage
</span></span></code></pre></div></div><nav class="pagination-nav mt-5" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/fault-injection/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label><i class="fa fa-chevron-left"></i> Fault Injection</div></a><a class="pagination-nav__link pagination-nav__link--next" href=https://cloud.layer5.io/academy/learning-paths/11111111-1111-1111-1111-111111111111/mastering-service-meshes-for-developers/introduction-to-service-meshes/circuit-breaking/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Circuit Breaking <i class="fa fa-chevron-right"></i></div></a></nav></div><div style=margin-top:2rem></div></main></div></div></div><script src=https://cloud.layer5.io/academy/js/main.min.93a3bf75eba7f67cb62933bdc16aff4dc235ec3930d0090a0bdf2a9941f29237.js integrity="sha256-k6O/deun9ny2KTO9wWr/TcI17Dkw0AkKC98qmUHykjc=" crossorigin=anonymous></script><script defer src=https://cloud.layer5.io/academy/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=https://cloud.layer5.io/academy/js/tabpane-persist.js></script><div id=myModal class=modal><button class=modal-close onclick=closeModal()>close</button><div class=modal-cont><img class=modal-pic id=modalPic onclick=closeModal() style=max-width:100%;max-height:80vh;margin:auto alt=Modal-pic></div></div><script>function openModal(e){var t;typeof e=="string"?t=document.getElementById(e).src:e instanceof HTMLImageElement&&(t=e.src),t&&t.includes("#")&&(t=t.substring(0,t.indexOf("#"))),document.getElementById("modalPic").src=t,document.getElementById("myModal").style.display="block"}function closeModal(){document.getElementById("modalPic").src="",document.getElementById("myModal").style.display="none"}document.addEventListener("keydown",function(e){e.key==="Escape"&&closeModal()}),document.addEventListener("DOMContentLoaded",function(){var e,t=document.querySelectorAll("img");t.forEach(function(e){e.onclick=function(){e.dataset.modal!=="false"&&openModal(e)}}),e=document.getElementById("myModal"),e.addEventListener("click",function(){closeModal()})})</script></body></html>